# Lambda/SES Email Forwarder
This project uses Amazon Lambda and API Gateway to forward emails using Amazon 
SES. It can be used on a static web site for example hosted on S3 as a contact form.

It is written in python and uses [Chalice](http://chalice.readthedocs.io/).

## Deployment
To deploy it:

1. Create a virtualenv with `virtualenv venv` then install the requirements with `pip install -r requirements.txt`.
2. Export your AWS credentials in your shell
3. Rename `email-forwarder` to something else
3. Run `chalice new-project email-forwarder`
4. Move the contents of whatever you renamed `email-forwarder` to into the `email-forwarder` directory generated by chalice.
5. Change into the `email-forwarder` directory.
6. Edit `chalicelib/config.ini`, updating it as necessary.
7. Run `chalice deploy` from the directory containing `app.py`.

Note: If you're committing this to git, make sure to remove `.chalice` from `email-forwarder/.gitignore` to commit your chalice config files.

You can now POST JSON encoded messages with the following structure to the 
endpoint returned by chalice:

    {
        "sender_name": <optional field for the sender's name>,
        "sender_email": <optional field for the sender's email address>,
        "body": <required field - the email body>,
        "domain": <required field - the domain of the site hosting the form. 
                   This will be put in the subject field>,
    }

Note: You need to set the content type to 'application/json'.

## Usage
To use this, generate a javascript SDK by running `chalice generate-sdk emailer-sdk`
then create a form like:

    <form>
      <!-- Change this to match a whitelisted domain in `config.ini` -->
      <input type="hidden" name="domain" value="example.com" />
      <p><input type="text" name="sender_name" /></p>
      <p><input type="email" name="sender_email" /></p>
      <p><textarea name="body></textarea></p>
      <p><input type="submit"></p>
    </form>

Finally, create some javascript to submit the form. You need to use javascript 
to submit the form because it needs to be submitted as JSON with a content type
of `application/json` which isn't possible when directly submitting the form
in a browser.

For a complete example, see the `examples` directory.
